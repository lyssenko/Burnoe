{% extends "base.html" %}

{% block title %}–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ{% endblock %}

{% block content %}
<h1>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã—Ö –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü–∞)</h1>
<h2>{{ actual_name }} vs {{ forecast_name }}</h2>

<form method="get" action="/compare_table" style="margin-bottom: 1em;">
  <input type="hidden" name="sensor_actual_id" value="{{ request.args.get('sensor_actual_id', '') }}">
  <input type="hidden" name="sensor_forecast_id" value="{{ request.args.get('sensor_forecast_id', '') }}">
  <input type="hidden" name="start_date" value="{{ request.args.get('start_date', '') }}">
  <input type="hidden" name="end_date" value="{{ request.args.get('end_date', '') }}">
  <label for="interval">–ò–Ω—Ç–µ—Ä–≤–∞–ª —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è:</label>
  <select name="interval" id="interval" onchange="this.form.submit()">
    <option value="15" {% if interval|int == 15 %}selected{% endif %}>15 –º–∏–Ω—É—Ç</option>
    <option value="30" {% if interval|int == 30 %}selected{% endif %}>30 –º–∏–Ω—É—Ç</option>
    <option value="60" {% if interval|int == 60 %}selected{% endif %}>1 —á–∞—Å</option>
  </select>
  <noscript><input type="submit" value="–ü—Ä–∏–º–µ–Ω–∏—Ç—å"></noscript>
</form>

{% if grouped_rows %}
{% for date, rows in grouped_rows.items() %}
<h3>{{ date }}</h3>
<table>
  <thead>
    <tr>
      <th>–ß–∞—Å</th>
      <th>–§–∞–∫—Ç (–í—Ç¬∑—á/–º¬≤)</th>
      <th>–ü—Ä–æ–≥–Ω–æ–∑</th>
      <th>–û—à–∏–±–∫–∞</th>
      <th>–û—à–∏–±–∫–∞ (%)</th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr>
      <td>{{ row.time }}</td>
      <td>{{ row.actual }}</td>
      <td>{{ row.forecast }}</td>
      <td>{{ row.error }}</td>
      <td>{{ row.percent }}</td>
    </tr>
    {% endfor %}
    {% set total = daily_totals | selectattr('date', 'equalto', date) | list | first %}
    <tr>
      <td><strong>–ò—Ç–æ–≥–æ –∑–∞ {{ date }}</strong></td>
      <td><strong>{{ total.actual }}</strong></td>
      <td><strong>{{ total.forecast }}</strong></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
<br />
{% endfor %}
{% else %}
<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
{% endif %}

<br />
<div style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px">
  <form action="/compare_table/export" method="get">
    <input type="hidden" name="sensor_actual_id" value="{{ request.args.sensor_actual_id }}" />
    <input type="hidden" name="sensor_forecast_id" value="{{ request.args.sensor_forecast_id }}" />
    <input type="hidden" name="start_date" value="{{ request.args.start_date }}" />
    <input type="hidden" name="end_date" value="{{ request.args.end_date }}" />
    <input type="hidden" name="interval" value="{{ interval }}">
    <button type="submit" class="button">üì• –°–∫–∞—á–∞—Ç—å CSV</button>
  </form>

  <form action="/compare_table/export_excel" method="get">
    <input type="hidden" name="sensor_actual_id" value="{{ request.args.sensor_actual_id }}" />
    <input type="hidden" name="sensor_forecast_id" value="{{ request.args.sensor_forecast_id }}" />
    <input type="hidden" name="start_date" value="{{ request.args.start_date }}" />
    <input type="hidden" name="end_date" value="{{ request.args.end_date }}" />
    <input type="hidden" name="interval" value="{{ interval }}">
    <button type="submit" class="button">üìä –°–∫–∞—á–∞—Ç—å Excel</button>
  </form>

  <form action="/compare" method="get">
    <input type="hidden" name="sensor_actual_id" value="{{ request.args.sensor_actual_id }}" />
    <input type="hidden" name="sensor_forecast_id" value="{{ request.args.sensor_forecast_id }}" />
    <input type="hidden" name="start_date" value="{{ request.args.start_date }}" />
    <input type="hidden" name="end_date" value="{{ request.args.end_date }}" />
    <input type="hidden" name="interval" value="{{ interval }}">
    <button type="submit" class="button">üìä –ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É</button>
  </form>

  <a href="/" class="button">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
  <a href="/compare_select" class="button">‚Ü© –ö –≤—ã–±–æ—Ä—É —Å–µ–Ω—Å–æ—Ä–æ–≤</a>
</div>

{% if total_actual_sum is not none and total_forecast_sum is not none %}
<h3>–ò—Ç–æ–≥–æ –∑–∞ –ø–µ—Ä–∏–æ–¥</h3>
<table>
  <thead>
    <tr>
      <th>–§–∞–∫—Ç (–í—Ç¬∑—á/–º¬≤)</th>
      <th>–ü—Ä–æ–≥–Ω–æ–∑</th>
      <th>–û—à–∏–±–∫–∞</th>
      <th>–û—à–∏–±–∫–∞ (%)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>{{ total_actual_sum }}</strong></td>
      <td><strong>{{ total_forecast_sum }}</strong></td>
      <td><strong>{{ abs_error }}</strong></td>
      <td><strong>{{ percent_error }}</strong></td>
    </tr>
  </tbody>
</table>
{% endif %}

{% endblock %}